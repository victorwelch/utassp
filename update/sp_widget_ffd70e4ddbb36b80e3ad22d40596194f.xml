<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>sc</category>
        <client_script><![CDATA[function ($scope, $http, spScUtil, spUtil, nowAttachmentHandler, $rootScope, $sanitize, $window, $sce, i18n, $timeout, $log, spAriaUtil, $document, spModal, $q, spAtf, $location, u_cutassp) {
	if (u_cutassp.utilIsValueValidAndTrue($scope.data.uSettings.isDebugOn)) {
		console.log((new Date()).getTime()+'.Client - '+$scope.data.infotag);
	}
	//
	/* widget controller */
	var c = this;

	c.myLabel = function (_p) { return u_cutassp.fmtLabel(_p); };
	c.myLog = function() {
		if (u_cutassp.utilIsValueValidAndTrue($scope.data.uSettings.isDebugOn)) {
			console.log((new Date()).getTime()+'.HTML View - '+$scope.data.infotag);
		}
		return '';
	};
	//
	$scope.isDisplay = true;
	c.flatListLength = 0;
	if (u_cutassp.utilIsValueValid(c.data.flatlist)) {
		if (u_cutassp.utilIsValueValid(c.data.flatlist.length)) {
			c.flatListLength = c.data.flatlist.length;	
		}		
	}	
	//	
	c.quantity = c.data.quantity ? c.data.quantity + "" : "1";
	c.mandatory = [];
	$scope.stickyHeaderTop = '0px';
	$scope.myAffectedServiceLink = {};

	c.widget._debugContextMenu = [
		[ i18n.getMessage("Open") + " sc_cat_item", function() {
			var item = c.data.sc_cat_item;
			$window.open("/sp_config?id=form&table=" + item.table + "&sys_id=" + item.sys_id); }]
	];
	
	// *** ****************** ***
	// Affected Service Selected Event
	//$rootScope.$on('onServiceSelected', function(event,selected) {
	//		//
	//		g_form.setValue('u_business_service',selected.sysid);
	//});
	//
	$scope.myAfectedServiceLinkHander = function(e) {
		$('#treePickerModal').modal('show');
		$('#treePickerModal').appendTo('body');		
	};
	//
	$scope.closeClick = function(e) {
		$('#treePickerModal').modal('hide');	
		for (var i=0;i<c.flatListLength;i++) {
			c.data.flatlist[i].ulstate = 'collapsed';
		}		
		$('body>#treePickerModal').remove();		
	};
	//
	$scope.divClick = function(e){
		var myDiv = $(e.currentTarget);
		var myLi= myDiv.parent();
		var myIdx = parseInt(myLi.attr('idnumber'));
		var myUlState = c.data.flatlist[myIdx].ulstate;
		// Close all
		for (var i=0;i<c.flatListLength;i++) {
			c.data.flatlist[i].ulstate = 'collapsed';
		}
		//Q: is this a tree node?
		if (myLi.attr('nodetype')=='tree') {
			//A: Yes.	
			// Open all ancestors
			var myAncestorLiList = myLi.parents('li');
			if (myAncestorLiList.length>0) {
				for (var j=0,jL=myAncestorLiList.length;j<jL;j++) {
					var aIdx = parseInt($(myAncestorLiList[j]).attr('idnumber'));
					c.data.flatlist[aIdx].ulstate='expanded';
				}
			}
			// Toggle current (close/open)
			if (myUlState == 'collapsed') {
				c.data.flatlist[myIdx].ulstate='expanded';			
			} else {
				c.data.flatlist[myIdx].ulstate='collapsed';				
			}	
		} else  {
			//A: No.  This is a leaf node...
			var mySysId = myLi.attr('sysid');
			var mySvcName = myLi.attr('name');
			$('#treePickerModal').modal('hide');	
			g_form.setValue('u_business_service',mySysId);
		}
	};

	$rootScope.$on('spModel.gForm.rendered', function() {
		//
		//$('#treePickerDiv').hide();
		$scope.myAffectedServiceLink = $($('a.select2-choice')[2]);
		$scope.myAffectedServiceLink.off();
		$scope.myAffectedServiceLink.on('click',$scope.myAfectedServiceLinkHander);
		//
		$timeout(function() {
							spAtf.init().then(function(atf) {
								$scope._atf = atf;
								atf.expose('catalog_util', catalogUtil);
							});
		}, 1000);
	});
	
	var catalogUtil = {
		submit: function () {
			var deferred = $q.defer();
			if (!$scope.triggerOnSubmit())
				deferred.reject("Can't submit form");
			var cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {
				$timeout(function() {
					cleanUp();
					deferred.resolve(result);
				}, 10);
			});
			return deferred.promise;
		},
		
		/* *** Removed following as not applicable, vcw 11/09/18 *** */
		//addToCart: function() {
		//},
		
		submitCatItem: function() {
			var defer = $q.defer();
			if ($scope.triggerOnSubmit()) {
				
				if ($scope.data.sys_properties.twostep) {
					defer.resolve();
				}
				else{ 
					var cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {
						$timeout(function() {
							cleanUp();
							result.single_step = true;
							defer.resolve(result);
						}, 10);
					});
				}
			}	
			else
				defer.reject();
			return defer.promise;
		},
		
		/* *** Removed following as not applicable, vcw 11/09/18 *** */
		//setQuantity: function(quantity) {
		//},
		
		/* *** Removed following as not applicable, vcw 11/09/18 *** */
		//getQuantity: function() {
		//},
		
		/* *** Removed following as not applicable, vcw 11/09/1 *** */
		//getPrice: function() {
		//}
		dummyNA: {}
	};
		
	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//c.showAddCartBtn = function() {
	//}
	
	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//c.showQuantitySelector = function() {
	//}

	c.showOrderNowButton = function() {
		return !$scope.data.is_cart_item && (c.data.sc_cat_item.use_sc_layout || !c.data.sc_cat_item.no_order_now);
	};

	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//c.showAddToWishlist = function () {
	//}

	c.allowOrder = function() {
		if (c.data.sc_cat_item.use_sc_layout)
			return true;

		if (c.data.sc_cat_item.no_order)
			return false;

		if (c.data.sc_cat_item.no_order_now && c.data.sc_cat_item.no_cart)
			return false;

		return true;
	};
	
	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//c.hideCartMsg = function () {
	//	$scope.data.showMsg = false;
	//};
	
	c.showAttachments = function() {
		return !$scope.submitted &&
			c.data.sc_cat_item.sys_class_name !== "std_change_record_producer";
	};
	
	$scope.$on('dialog.upload_too_large.show', function(e){
		$log.error($scope.m.largeAttachmentMsg);
		spUtil.addErrorMessage($scope.m.largeAttachmentMsg);
	});

	$scope.m = $scope.data.msgs;
	var ah = $scope.attachmentHandler = new nowAttachmentHandler(setAttachments, appendError);
	function appendError(error) {
		spUtil.addErrorMessage(error.msg + error.fileName);
	}
	ah.setParams($scope.data._attachmentTable, $scope.data._generatedItemGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);
	function setAttachments(attachments, action) {
		$scope.attachments = attachments;
		if (action === "added")
			$scope.setFocusToAttachment();
		if (action === "renamed")
			spAriaUtil.sendLiveMessage($scope.m.renameSuccessMsg);
		if (action === "deleted")
			spAriaUtil.sendLiveMessage($scope.m.deleteSuccessMsg);
	}
	$scope.attachmentHandler.getAttachmentList();

	$scope.confirmDeleteAttachment = function(attachment) {
		spModal.confirm($scope.data.msgs.delete_attachment).then(function() {
			$scope.attachmentHandler.deleteAttachment(attachment);
			$('#add_attachment_button').focus();
		});
	};

	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//$scope.dismissWishListMessage = function() {
	//	$scope.is_update_wishlist = false;
	//};
	
	if ($scope.data.sc_cat_item) {
		$scope.data.sc_cat_item.description = $sce.trustAsHtml($scope.data.sc_cat_item.description);
		if (angular.equals($scope.data.sc_cat_item._fields, {}))
			$scope.data.no_fields = true;
		if ($scope.data.sc_cat_item.sys_class_name !== "sc_cat_item_producer" && $scope.data.sc_cat_item.sys_class_name !== "std_change_record_producer")
			$scope.submitButtonMsg = $scope.m.orderNowMsg;
		else
			$scope.submitButtonMsg = $scope.m.submitMsg;

	   /* *** Removed following as not applicable, vcw 11/09/18 *** */
		// Breadcrumbs
		//if (!$scope.data.categories)
		//if ($scope.data.is_wishlist_item) {
		//}
		//else if ($scope.data.is_cart_item) {
		//}
		//else if ($scope.data.categories.length > 0) {
		//}
		//else {
		//}

		//$timeout(function() {
		//	$scope.$emit('sp.update.breadcrumbs', $scope.data.categories);
		//});
		spUtil.setSearchPage('sc');
	} else {
		var notFoundBC = [{label: $scope.page.title, url: '?id=' + $scope.data.sc_catalog_page}];
		$timeout(function() {
			$scope.$emit('sp.update.breadcrumbs', notFoundBC);
		});
		spUtil.setSearchPage('sc');
	}

	c.getItemId = function () {
		return $scope.data.sc_cat_item ? $scope.data.sc_cat_item.sys_id : -1;
	};

	var g_form;
	$scope.$on('spModel.gForm.initialized', function(e, gFormInstance){
		if (gFormInstance.getSysId() != -1 && gFormInstance.getSysId() != c.getItemId())
			return;
		g_form = gFormInstance;
		
		$timeout(function() {
				$rootScope.$emit('spModel.gForm.rendered', g_form);
		}, 175);
		
		// This runs after all onSubmit scripts have executed
		g_form.$private.events.on('submitted', function(){
			if ($scope.data.sc_cat_item.item_action === "order")
				getOne();
			else if ($scope.data.sc_cat_item.item_action === "add_to_cart")
				addToCart();
			else if ($scope.data.sc_cat_item.item_action == "update_cart")
				updateCart();
		});
	});

	function getVarData(fields) {
		var reqData = {};
		for(var obj in fields)
			reqData[fields[obj].name] = fields[obj].value;
		return reqData;
	}

	function addLink(url, msg) {
		return " <a href=" + url + ">" + msg + "</a>";
	}
	
	/* *** Removed following as not applicable, vcw 11/09/18 *** */	
	//$scope.$on("$sp.service_catalog.wishlist.update", function(evt, item) {
	//	if (item === $scope.data.sys_id)
	//		$scope.data.show_wishlist_msg = false;
	//});

	/* *** Removed following as not applicable, vcw 11/09/18 *** */	
	//$scope.addToWishlist = function() {
	//}

	/* *** Removed following as not applicable, vcw 11/09/18 *** */	
	//$scope.triggerAddToCart = function() {
	//}

	/* *** Removed following as not applicable, vcw 11/09/18 *** */	
	//$scope.triggerUpdateCart = function() {
	//}

	$scope.triggerOnSubmit = function(){
		if ($scope.options.isServiceWorkspace && $window.frameElement) {
			var workspaceParams = {};
			workspaceParams.sysparm_parent_table = $window.frameElement.getAttribute('parent-table');
			workspaceParams.sysparm_parent_sys_id = $window.frameElement.getAttribute('parent-sys-id');
			$scope.data.workspaceParams = workspaceParams;
		}
		$scope.data.sc_cat_item.item_action = "order";
		$scope.data.sc_cat_item.quantity = c.quantity;
		if (g_form) {
			return g_form.submit();			
		}
		return false;
	};

	function setFieldsReadonly() {
		var allFields = g_form.getFieldNames();
		for (var fieldName in allFields) {
			g_form.setReadonly(allFields[fieldName], true);
		}
	}

	// order / create request
	function getOne() {
		$scope.server.get({
			action: 'log_request',
			itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, 
						  name: $scope.data.sc_cat_item.name,
						  sys_class_name: $scope.data.sc_cat_item.sys_class_name}
		});

		//Required to pass as payload for usage as embeddedWidget
		var embeddedWidgetOptions = {
			"auto_redirect" : "true",
			"requested_for_id" : "",
			"requested_for_display" : ""
		};

		if ($scope.data.sc_cat_item.sys_class_name != "sc_cat_item_producer" && $scope.data.sc_cat_item.sys_class_name != "std_change_record_producer") {
			if ($scope.data.sys_properties.twostep) {
				var payload = {
					cart: 'cart_' + $scope.data.sc_cat_item.sys_id,
					itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, quantity: $scope.data.sc_cat_item.quantity, fields: getVarData($scope.data.sc_cat_item._fields), newRecordID: $scope.data._generatedItemGUID},
					action: $scope.data.is_wishlist_item ? "order_wishlist_item" : "order_item",
					workspaceParams: $scope.data.workspaceParams
				};
				for (var embeddedOption in embeddedWidgetOptions) {
					payload[embeddedOption] = c.options[embeddedOption] || embeddedWidgetOptions[embeddedOption];
				}
				$scope.server.get(payload).then(function(response) {
					var orderItemModalCtrl;
					var unregister = $scope.$on('$sp.service_catalog.cart.cancel_order', function(){
						orderItemModalCtrl.close();
					});
					var closeModalOnSubmit = $scope.$on('$sp.service_catalog.cart.submitted', function(){
						orderItemModalCtrl.close();
						setFieldsReadonly();
						$scope.submitted = true;
					});

					var orderItemModal = angular.copy(response.data.orderItemModal);
					orderItemModal.options.afterOpen = function(ctrl){
						orderItemModalCtrl = ctrl;
					};
					orderItemModal.options.afterClose = function() {
							unregister();
							closeModalOnSubmit();
							c.orderItemModal = null;
							orderItemModalCtrl = null;
						};
						c.orderItemModal = orderItemModal;
					});
			} else {
				var additionalParms = {};
				if ($scope.data.workspaceParams) {
					additionalParms.sysparm_parent_sys_id = $scope.data.workspaceParams.sysparm_parent_sys_id;
					additionalParms.sysparm_parent_table = $scope.data.workspaceParams.sysparm_parent_table;
				}
				if ($scope.data.is_wishlist_item) {
				
					spScUtil.orderWishlistedItem($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {
						var a = response.data.result;
						$scope.$emit("$$uiNotification", a.$$uiNotification);
						$scope.$emit("$sp.sc_cat_item.submitted", a);
						$rootScope.$broadcast("$sp.service_catalog.wishlist.update");
						if (c.options.auto_redirect == 'false') {
							$rootScope.$broadcast("$sp.service_catalog.cart.submitted", true);
							spUtil.addInfoMessage($scope.m.requestSubmitted);
							return;
						} else {
							//$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);
							$location.search('id=utassp01_view_tickets&pageid=request');	
						}
					});
				}
				else 
				{
					spScUtil.orderNow($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {
							var a = response.data.result;

							$scope.$emit("$$uiNotification", a.$$uiNotification);
							$scope.$emit("$sp.sc_cat_item.submitted", a);
							if (c.options.auto_redirect == 'false') {
								$rootScope.$broadcast("$sp.service_catalog.cart.submitted", true);
								spUtil.addInfoMessage($scope.m.requestSubmitted);
								return;
							} else if (!$scope._atf) {
								//$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);
								$location.search('id=utassp01_view_tickets&pageid=request');							
							}
					});
				}
			}
		} else {
			postCatalogFormRequest().then(function(response) {
				var a = response.data.result;
				if (!$scope.options.isServiceWorkspace)
				$scope.$emit("$$uiNotification", a.$$uiNotification);
				$scope.$emit("$sp.sc_cat_item.submitted", a);
				if ($scope.data.is_wishlist_item)
					$rootScope.$broadcast("$sp.service_catalog.wishlist.update");
				if (c.options.auto_redirect == 'false') {
					setFieldsReadonly();
					$scope.submitted = true;
				} else if (!$scope._atf)
						handleRedirect(a.number, a.table, a.sys_id, a.redirect_to, a.redirect_portal_url);
				//$scope.submitting = false;
				$scope.submitButtonMsg = $scope.m.submittedMsg;
			});
		}
	}

	/* *** Removed following as not applicable, vcw 11/09/18 *** */	
	//function addToCart() {
	//}

	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//function updateCart() {
	//}

	function postCatalogFormRequest() {
		$('#sc_cat_item').find('*').css('color','#cccccc');
		$scope.submitting = true;
		if ($scope.data.is_wishlist_item) {
			$scope.is_update_wishlist = false;
			$scope.data.show_wishlist_msg = false;
			if ($scope.data.sc_cat_item.sys_class_name === "sc_cat_item_producer")
				return spScUtil.submitWishlistedProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams);
			else if ($scope.data.sc_cat_item.item_action === "add_to_cart")
				return spScUtil.addWishlistedItemToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID);
		}
		else if ($scope.data.is_cart_item)
			return spScUtil.updateCart($scope.data._generatedItemGUID, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields));
		else if ($scope.data.sc_cat_item.sys_class_name === "sc_cat_item_producer")
			return spScUtil.submitProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams);
		else if ($scope.data.sc_cat_item.sys_class_name === "std_change_record_producer")
			return spScUtil.submitStdChgProducer($scope.data.sc_cat_item.sys_id, $scope.data.stdChg.twoStep, $scope.data.stdChg.currentVersion, $scope.data._generatedItemGUID);
		/* *** Removed following as not applicable, vcw 11/09/18 *** */	
		//else if ($scope.data.sc_cat_item.item_action === "add_to_cart")
		//	return spScUtil.addToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID);
	}

	// spModel populates mandatory - hasMandatory is called by the submit button
	$scope.hasMandatory = function() {
		return c.mandatory && c.mandatory.length > 0;
	};

	// switch catalog items
	var unregister = $scope.$on('$sp.list.click', onListClick);
	$scope.$on("$destroy", function() {
		$rootScope.$broadcast("$sp.service_catalog.item.close");
		unregister();
	});

	function onListClick(evt, arg) {
		$scope.data.sys_id = arg.sys_id;
		spUtil.update($scope);
	}
	
	/* *** Removed following as not applicable, vcw 11/09/18 *** */
	//function formatRedirectUrl(page, table, sys_id) {
	//	var url;
	//	var paramObj = {page: page, table: table, sys_id: sys_id};
	//	url = spUtil.format(c.options.url, paramObj);
	//	return url;
	//}
	
	function handleRedirect(n, table, sys_id, redirectTo, redirectUrl) {
			/* *** Removed following as not applicable, vcw 11/09/18 *** */
			//var page = 'form';
			//if (table == 'sc_request')
			//	page = 'sc_request';
			//else if (n)
			//	page = 'ticket';

			//if (redirectTo == 'catalog_home') 
			//	page = 'sc_home';

			////For Standard change, always direct to form
			//if ($scope.data.sc_cat_item.sys_class_name === "std_change_record_producer")
			//	page = 'form';

			//if (c.options.page) {page = c.options.page;}
			//if (c.options.table) {table = c.options.table;}
			//var url = formatRedirectUrl(page, table, sys_id);
			//if ($scope.data.sc_cat_item.sys_class_name === "sc_cat_item_producer" || $scope.data.sc_cat_item.sys_class_name === "std_change_record_producer") {
			//	if (redirectUrl) {
			//		$window.location.href = redirectUrl;				
			//	} else {
			//		$location.search(url);				
			//	}
		
			/* *** Start block -- added the following , vcw 11/09/18 *** */
			var myOptionUrl=c.options.url;
			var myPageId = c.data.pageid || '';
			var myParamObj = {pageid: myPageId};
			var myUrl=spUtil.format(myOptionUrl, myParamObj);
			$location.search(myUrl);
			/* *** End block -- added the following , vcw 11/09/18 *** */
			
			return;
		//}
		//$location.search(formatRedirectUrl('sc_request', 'sc_request', sys_id));
		//return;
	}
    
    $timeout(function() {
        if ($document[0].getElementsByClassName('sc-sticky-item-header').length > 0) {
            var titleHeight = $document[0].getElementsByClassName('sc-sticky-item-header')[0].clientHeight;
            $scope.stickyHeaderTop = '-' + (titleHeight - 20 - $document[0].getElementsByClassName('sc-cat-item-short-description')[0].clientHeight) + 'px;';
        }
    });
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.panel-button {
  float: none;
}

.sp-attachment-add {
  padding: 5px;
}

.p-t-none {
  padding-top: 0 !important;
}

.file-list-wrap {
	margin-bottom: 10px;
}

.sc-btn {
  color: $text-color;
}

.dismiss-button {
  position: absolute;
  top: 1rem;
	right: 10px;
	color: $text-color;
	cursor: pointer;
}

.item-header {
  padding-top: 10px !important;
  padding-bottom: 10px !important;
}

.sc-sticky-item-header {
  position: sticky;
  position: -webkit-sticky;
  position: -ms-sticky;
  top: -($font-size-h2 + $font-size-base);
  z-index: 10;
  background-color: inherit;
  border-radius: 4px 4px 0 0;
}
.sc-fixed {
  position: fixed;
  max-height: 100%;
  width: 17.67777%;
}
.no-margin {
	margin: 0px; 
}
.sc-item-error-messages {
  max-height: 100%;
  position: absolute;
  overflow-y: auto;
  overflow-x: hidden;
  width: 100%; 
}
.sc-field-error-label {
  margin-right: .5em; 
  display: inline-block;
  cursor: pointer;
}
.image-gallery {
  font-size: 8px;
  color: #CECECE;
  .active {
    color: #717171;
  }
  i {
    padding: 0 5px;
  }
}
.relative {
  position: relative;
}
.sc-order-widget-btn {
   position: absolute;
   left: 9%;
   top: 10px
}
@media (min-width: 992px)
  .col-md-12 {
    width:100%;
  }
@media only screen and (max-width : 992px) {
  .sc-fixed {
    position: relative;
    width: 100%;
  }
  .wishlist-update-message {
    display : block;
  }
  .sc-item-error-messages {
    position: relative;
  }
  .read-more, .read-less {
    font-size: 15px;
    cursor: pointer;
  }
  .more-text {
    display: none;
  }
  /*
  .inline-cart {
    display: none;
  }
  .right-side-cart {
    display: inherit !important;
  }
  */
}
@media only screen and (max-width : 768px) {
  .sc-sticky-item-header {
     position: inherit;
  }
  
}
.inline-cart {
  .quantity-selector {
    display: inline-block !important;
    width: 65px;
    padding-top: 2px;
  }
}
/* ************ */
#treePickerDiv.myInitHide {
  display:none;
}
div.myTitle {
  color: #3a3f51;
  background-color: #f5f5f5;
  border-top: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-left: 1px solid #ddd;
  font-weight:bold;
  margin: 0;
  font-size: 20px;
  padding: 5px 10px 5px 10px;
}

h1,  h2,  h3,  h4,  h5,  h6,  p,  li {
    font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
}

.modal-panel-body {
  padding: 0;
  display: inline-table;
  background-color: #fff;
	box-sizing: border-box;
}
#baseUl {
  padding-left: 0px;  
  list-style-type: none;
  margin:0;
}
ul.modalTp {
  list-style-type: none;
  padding-left: 18px;
  margin:0;
}
div.myHeaderModal {
  padding:4px 4px 4px 6px;
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  font-size:15px;
  color:#fff;
  background-color:#0064b1;
  display:block;
  margin:0;
}
i.myCloseModal {
  float:right;
  padding-right:4px;
  padding-top:3px;
  &amp;:hover {
    cursor:pointer;
  }
}
div.myLiDivModal {
  opacity:.75 !important;
  &amp;:hover {
    cursor:pointer;
    opacity:1 !important;
  }
}
div.myImgHolderModal {
  display: inline-block;
  width: 36px;
  height: 16px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: auto;	
}
div.myPlusModal {
  background-image: url(treePlus.png);
}
div.myMinusModal {
  background-image: url(treeMinus.png);
}
div.myLeafModal {
  background-image: url(leaf.png);
}
div.myNodeModal {
  display: inline-block;
  font-size: 13px;
  position: relative;
  top: -4px;
  padding-left: 4px;		
}
div.myLinkModal {
  color: #0064b1;
  text-decoration: underline;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color</field_list>
        <has_preview>false</has_preview>
        <id>utassp04_catalog_item_incident_widget</id>
        <internal>false</internal>
        <link><![CDATA[function(scope, elem){
    scope.setFocusToAttachment = function () {
		setTimeout(function () {
			var inboxArray = elem.find("a.view-attachment");
			inboxArray.focus();
		}, 100);
	};
}
	]]></link>
        <name>UTASSP Catalog Item Incident Widget 4</name>
        <option_schema>[{
	"name": "show_add_cart_button",
  	"default_value": "false",
	"section": "other",
	"label": "Show Add Cart Button",
	"type": "boolean"
}, {
	"hint": "If you turn on this, you will be able to see field validation messages on right side",
	"name": "show_field_validation_messages",
	"default_value": "true",
	"section": "other",
	"label": "Show field validation messages",
	"type": "boolean"
}, {
	"hint": "Show Add/Update Wish List buttons",
	"name": "show_add_to_wishlist_button",
	"default_value": "false",
	"section": "other",
	"label": "Show Add/Update Wish List buttons",
	"type": "boolean"
}, {
	"hint": "Order item section on top. If you uncheck this, order section will be displayed at bottom of screen",
	"name": "display_cart_on_right",
	"default_value": "true",
	"section": "other",
	"label": "Order Item Section On Top",
	"type": "boolean"
}, {
	"hint": "Show item description in few words with an option to read more",
	"name": "show_less_description",
	"default_value": "true",
	"section": "other",
	"label": "Enable Show More/Less for Item description on Mobile",
	"type": "boolean"
}, {
	"hint": "Hide the Delivery Time in the widget",
	"name": "hide_delivery_time",
	"section": "other",
	"default_value": "false",
	"label": "Hide Delivery Time",
	"type": "boolean"
}, {
	"hint": "Simplified redirect",
	"name": "url",
	"section": "other",
	"default_value": "id=utassp01_my_tickets&amp;pageid={pageid}",
	"label": "Url",
	"type": "string"
}]</option_schema>
        <public>false</public>
        <roles>snc_external,snc_internal</roles>
        <script><![CDATA[// populate the 'data' variable with catalog item, variables, and variable view
(function($sp, input, data, options, gs) {
	var myU = new u_utassp();
	data.uSettings=myU.utilGetInstanceSettings();
	// *** Start: Debug only code *** //
	data.infotag = '';
	if (myU.utilIsValueValidAndTrue(data.uSettings.isDebugOn)) {
		data.infotag = myU.utilLog($sp);
	}
	// *** End: Debug only code *** //
	//
	var myTreeData = myU.getBusinessServiceTree('empty');
	var myFlatData = myU.getFlatBusinessServiceTree(myTreeData);

	data.treelist = myTreeData;
	data.flatlist = myFlatData;	
	//
	var embeddedWidgetOptions = ['auto_redirect', 'requested_for_id', 'requested_for_display'];
	if (input && input.action == 'init_item') {
		data._generatedItemGUID = gs.generateGUID();
		return;
	}
	else if (input && input.action === "order_one_step") {
		
	}
	else if (input && input.action === "order_item") {
		//Minimum set of widget options supported for Embedded widget
		embeddedWidgetOptions.forEach(function (embeddedWidgetOption) {
			if (typeof input[embeddedWidgetOption] != 'undefined')
				options[embeddedWidgetOption] = input[embeddedWidgetOption];
		});
		data.orderItemModal = $sp.getWidget('widget-modal', {
			embeddedWidgetId: 'utassp01_sc_checkout_widget', 
			embeddedWidgetOptions: {
				cart: {name: input.cart}, 
				action: 'order_now', 
				item: input.itemDetails, 
				requested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},
				auto_redirect: options.auto_redirect,
				parentParams: input.workspaceParams
			}, 
			backdrop: 'static', 
			keyboard: false, 
			size: 'md'
		});
		return;
	} else if (input && input.action == "order_wishlist_item") {
		//Minimum set of widget options supported for Embedded widget
		embeddedWidgetOptions.forEach(function (embeddedWidgetOption) {
			if (typeof input[embeddedWidgetOption] != 'undefined')
				options[embeddedWidgetOption] = input[embeddedWidgetOption];
		});
		data.orderItemModal = $sp.getWidget('widget-modal', {
			embeddedWidgetId: 'utassp01_sc_checkout_widget', 
			embeddedWidgetOptions: {
				cart: {name: input.cart}, 
				action: 'order_now_wishlisted_item', 
				item: input.itemDetails, 
				requested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},
				auto_redirect: options.auto_redirect,
				parentParams: input.workspaceParams
			}, 
			backdrop: 'static', 
			keyboard: false, 
			size: 'md'
		});
		return;
	} else if (input && input.action === 'log_request') {
		 $sp.logStat('Cat Item Request', input.itemDetails.sys_class_name, input.itemDetails.sys_id, input.itemDetails.name);
		 return;
	}

	// portal can specify a catalog and catalog category home page
	data.sc_catalog_page = $sp.getDisplayValue("sc_catalog_page") || "sc_home";
	data.sc_category_page = $sp.getDisplayValue("sc_category_page") || "sc_category";
	data.sc_catalog = $sp.getDisplayValue('sc_catalog');

	/* *** removed following as Not Applicable, vcw 11/09/18 *** */
	//var edit_parm = $sp.getParameter('edit');

	data.show_wishlist_msg = false;
	data.recordFound = true;
	var catalogID = $sp.getValue('sc_catalog');

	/* *** removed following as Not Applicable, vcw 11/09/18 *** */	
	//options.show_add_cart_button = (options.show_add_cart_button == "true");
	//if (options.show_add_cart_button) {
	//}

	/* *** removed following as Not Applicable, vcw 11/09/18 *** */	
	//if (options.page) {
	//}
	//if (options.table) {
	//}
	options.url = options.url || "id={page}&is_new_order=true&table={table}&sys_id={sys_id}";		

	data.showPrices = $sp.showCatalogPrices();
	var m = data.msgs = {};
	m.submitMsg = gs.getMessage("Submit");
	m.orderNowMsg = gs.getMessage("Order Now");
	m.submittedMsg = gs.getMessage("Submitted");
	m.createdMsg = gs.getMessage("Created");
	m.trackMsg = gs.getMessage("track using 'Requests' in the header or");
	m.clickMsg = gs.getMessage("click here to view");
	m.dialogTitle = gs.getMessage("Delete Attachment");
	m.dialogMessage = gs.getMessage("Are you sure?");
	m.dialogOK = gs.getMessage("OK");
	m.dialogCancel = gs.getMessage("Cancel");
	
	m.renameSuccessMsg = gs.getMessage("Attachment renamed successfully");
	m.deleteSuccessMsg = gs.getMessage("Attachment deleted successfully");
	m.wishlistMsg = gs.getMessage('Wish List');
	m.cartMsg = gs.getMessage('Cart');
	m.itemWishlistMsg = gs.getMessage('This item is already in your Wish List. If you attempt to add this item to your Wish List it will overwrite the existing item.');
	m.invalidRecordMsg = gs.getMessage('You are either not authorized or record is not valid.');
	m.wishlistUpdateMsg = gs.getMessage('Your Wish List has been updated.');
	m.wishlistAddMsg = gs.getMessage('Your item has been added to your Wish List.');
	m.cartAddMsg = gs.getMessage('Your item has been added to your Cart. To make changes to the items in your cart, click ');
	m.viewWishListMsg = gs.getMessage('View Wish List');
	m.viewCartMsg = gs.getMessage('View Cart');
	m.delete_attachment = gs.getMessage("Delete Attachment?");

	data.maxAttachmentSize = parseInt(gs.getProperty("com.glide.attachment.max_size", 1024));
	if (isNaN(data.maxAttachmentSize))
		data.maxAttachmentSize = 24;
	m.largeAttachmentMsg = gs.getMessage("Attached files must be smaller than {0} - please try again", "" + data.maxAttachmentSize + "MB");
	
	var cartName = data.is_cart_item ? 'DEFAULT' : 'saved_items';
	var cart = new sn_sc.CartJS(cartName);

	data.showWishlist = new sn_sc.Catalog('' + catalogID).isWishlistEnabled();

	/* *** removed following as Not Applicable, vcw 11/09/18 *** */	
	/* *** block start *** */
	//if (edit_parm) {
	//} else 
	//{

		/* *** start block added, vcw 2/11/19 *** */

		//* 
		//* *** First, get name of affected service (to pre-populate form)
		var mySvcSysid = $sp.getParameter('svcsysid');
		var mySession = gs.getSession();
		var mySvcName = '';
		if (myU.utilIsValueValid(mySvcSysid)) {
			var mySvcGr = new GlideRecord('cmdb_ci_service');
			if (mySvcGr.get(mySvcSysid)) {
				mySvcName = mySvcGr.getValue('name');
				mySession.putClientData('svcname', mySvcName);
				data.svcSysid = mySvcSysid;
				data.svcName = mySvcName;
			}
		}

		//* *** Next, get the form (record producer sysId)
		var myGr = new GlideRecord('sc_cat_item_producer');
		var myQuery = 'active=true';
		myQuery += '^sys_scope=2e58c8624f112300f006121f9310c726';
		myQuery += '^name=Incident Report 2';
		myGr.addEncodedQuery(myQuery);
		myGr.query();
		if (myGr.next()) {
			data.sys_id = myGr.getValue('sys_id');
			data.pageid='incident';			
		}
		/* *** end block added, vcw 2/11/19 *** */
	
		data._generatedItemGUID = gs.generateGUID();
		var validatedItem = new sn_sc.CatItem('' + data.sys_id);
		if (!validatedItem.canView() || !validatedItem.isVisibleServicePortal()) {
			data.recordFound = false;
			return;
		}
	
		data.sc_cat_item = $sp.getCatalogItem(data.sys_id, true);
		data.hideDeliveryTime = (options.hide_delivery_time == "true" || data.sc_cat_item.sys_class_name == 'sc_cat_item_producer' || data.sc_cat_item.sys_class_name == 'sc_cat_item_guide' || data.sc_cat_item.sys_class_name == 'std_change_record_producer');
		if (data.sc_cat_item.category) {
			var categoryJS;
			var categoryID = validatedItem.getFirstAccessibleCategoryForSearch(catalogID);
			if ($sp.getParameter("sysparm_category")) {
				categoryJS = new sn_sc.CatCategory($sp.getParameter("sysparm_category") + "");
				categoryID = $sp.getParameter("sysparm_category") + "";
			}
			else {
				categoryJS = new sn_sc.CatCategory(categoryID);
			}
			
			data.category = {
				name: categoryJS.getTitle(),
				url: categoryJS.canView() ? '?id=' + data.sc_category_page + '&sys_id=' + categoryID : "#"
			};
			data.categories = [];
			if (categoryJS && GlideStringUtil.isEligibleSysID(categoryJS.getID()))
				data.categories.push({
					label: categoryJS.getTitle(),
					url: categoryJS.canView() ? '?id=' + data.sc_category_page + '&sys_id=' + categoryID : "#"
				});
			while(categoryJS && categoryJS.getParent()) {
				var parentId =  categoryJS.getParent();
				categoryJS = new sn_sc.CatCategory(parentId);
				var category = {
					label: categoryJS.getTitle(),
					url: categoryJS.canView() ? '?id=' + data.sc_category_page + '&sys_id=' + parentId : "#"
				};
				data.categories.unshift(category);
			}
		}
		var gr1 = new GlideRecord('sc_cart_item');
		gr1.addQuery('cart', cart.getCartID());
		gr1.addQuery('cat_item', data.sys_id);
		gr1.query();
		if (gr1.next() && !options.isServiceWorkspace)
			data.show_wishlist_msg = true;
	/* *** updated, vcw 11/09/18 *** */	
	/* *** block end *** */	
	//}

	data.sys_properties = {
		twostep: gs.getProperty("glide.sc.sp.twostep", "true") == 'true'
	};

	var athTblName = 'sc_cart_item';
	var className = data.sc_cat_item.sys_class_name;
	if (!new global.CatalogItemTypeProcessor().canCreateNormalCartItem(className)) {
		
		if (className == 'sc_cat_item_producer' || className == 'std_change_record_producer') {
				var gr2 = new GlideRecord(className);
				gr2.get(data.sc_cat_item.sys_id);
				if (gr2.isValidRecord())
					athTblName = gr2.getValue('table_name');
		}
	}
	data._attachmentTable = athTblName;

	data.stdChg = {};
	if (className === 'std_change_record_producer') {
		//Populate scope with the porperty for two step
		data.stdChg.twoStep = false;
		var twoStepProp = new global.StdChangeUtils().getValue('two_step') + '';
		if (twoStepProp)
			data.stdChg.twoStep = twoStepProp === '1';

		var stdChgProducerGr = new GlideRecord('std_change_record_producer');
		stdChgProducerGr.get(data.sc_cat_item.sys_id);
		if (stdChgProducerGr.isValidRecord())
			data.stdChg.currentVersion = stdChgProducerGr.getValue('current_version');
	}
	
	$sp.logStat('Cat Item View', data.sc_cat_item.sys_class_name, data.sc_cat_item.sys_id, data.sc_cat_item.name);
	

			
})($sp, input, data, options, gs)]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>welchv</sys_created_by>
        <sys_created_on>2019-02-21 16:59:10</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>ffd70e4ddbb36b80e3ad22d40596194f</sys_id>
        <sys_mod_count>39</sys_mod_count>
        <sys_name>UTASSP Catalog Item Incident Widget 4</sys_name>
        <sys_package display_value="utassp" source="x_287765_utassp">2e58c8624f112300f006121f9310c726</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="utassp">2e58c8624f112300f006121f9310c726</sys_scope>
        <sys_update_name>sp_widget_ffd70e4ddbb36b80e3ad22d40596194f</sys_update_name>
        <sys_updated_by>welchv</sys_updated_by>
        <sys_updated_on>2019-03-07 01:41:43</sys_updated_on>
        <template><![CDATA[<div id="sc_cat_item" ng-if="::data.recordFound" dummy="{{::c.myLog()}}">
  <div class="myTitle">
    Something Wrong? Report Incident...    
  </div>
	<div class="row" ng-if="::data.sc_cat_item">	
		<!-- ************************************************************ -->
    <div class="col-sm-12" ng-class="{true: 'col-md-9', false: 'col-md-12'}[options.display_cart_on_right === 'true']" id="catItemTop">
			<div class="panel panel-default">
				<!-- ------------- -->
				<div class="" ng-class="{'b-b wrapper-md': !data.no_fields}">
					<sp-cat-item item="::data.sc_cat_item"></sp-cat-item>
					<form>
						<!-- display view and model -->
						<sp-model form-model="::data.sc_cat_item" mandatory="c.mandatory"></sp-model>
					</form>
				</div>
				<!-- Bottom cart -->
				<div class="inline-cart" ng-if="::options.display_cart_on_right !== 'true'">
					<div class="wrapper-md b-b">
						<button 
                    id="submitButtonId" 
                    tabindex="0" 
                    name="submit" 
                    ng-disabled="submitting || submitted"
						 				ng-click="triggerOnSubmit()" 
                    class="btn btn-primary">{{::submitButtonMsg}}</button>
						<span ng-if="submitting" style="padding-left:4px">${Submitting...}</span>
					</div>
					<div ng-show="hasMandatory(c.mandatory)" class="alert alert-info" style="margin-top: .5em" ng-if="c.options.show_field_validation_messages === 'true'">
						<span ng-if="hasMandatory(mandatory)">${Required information} </span>
						<label ng-repeat="f in c.mandatory" 
                   for="sp_formfield_{{::f.catalogFieldName}}" 
                   class="label label-danger sc-field-error-label"
						 			 style="margin-right: .5em; display: inline-block;">{{::f.label}}</label>
					</div>
				</div>
			</div>
			<div ng-if="c.showAttachments()" class="wrapper-md row no-margin">
				<now-attachments-list template="sp_attachment_single_line"></now-attachments-list>
				<label ng-if="!submitting && !submitted" style="float:right;font-weight:normal;cursor:pointer;">
					<sp-attachment-button></sp-attachment-button>
					<span style="padding-left:4px;">${Add attachments}</span>
				</label>
			</div>
		</div>
    <!-- ************************************************************ -->  
    <!-- Right side content -->
    <!-- ************************************************************ -->  
    <div class="col-sm-12 col-md-3 right-side-cart" ng-show="::options.display_cart_on_right === 'true'">
      <!-- Right side cart( If you are chaning anything here, please change in bottom cart section also) -->
      <div ng-class="{true:'sc-fixed', false:'' }[options.display_cart_on_right === 'true']">
      	<div ng-if="data.sc_cat_item.sys_class_name != 'sc_cat_item_content'" class="panel panel-{{::options.color}} b wrapper-md">
           <div class="form-group">
             <button 
                     ng-if="::c.showOrderNowButton()" 
                     tabindex="0" 
                     name="submit" 
                     ng-disabled="submitting || submitted" 
                     ng-click="triggerOnSubmit()" 
                     class="btn btn-primary btn-block">{{::submitButtonMsg}}</button>
             <span ng-if="submitting" style="padding-left:4px">${Submitting...}</span>
           </div>
         </div>
      	<div class="sc-item-error-messages" ng-if="c.options.show_field_validation_messages === 'true'">
            <div class="row" ng-if="hasMandatory(c.mandatory)" class=" row alert alert-info" style="margin-top: .5em">
              <div class="col-sm-12">
                <div ng-if="hasMandatory(c.mandatory)">${Required information} </div>
                <label ng-repeat="f in c.mandatory" 
                       for="sp_formfield_{{::f.name}}" 
                       class="label label-danger sc-field-error-label">{{::f.label}}</label>
              </div>
           </div>
         </div>
      </div>
    </div>
    <!-- ************************************************************ -->      
	</div>  
</div>

<!-- ************************************************************************************************************************ -->      
<!-- ************************************************************************************************************************ -->      

<!-- Modal Tree Picker -->
<div class="modal" 
     id="treePickerModal" 
     tabindex="-1" 
     role="dialog" 
     aria-labelledby="Affected Service"
     aria-hidden="true">
  <div class="modal-dialog" role="document" style="background:transparent;">
    <div class="modal-content clickable" style="display:inline-table;border-radius:0;">
      <div class="modal-header" style="padding:0;">
        <div class="modal-title myHeaderModal">
          Select Affected Service<i class="far fa-window-close myCloseModal" ng-click="closeClick($event)"></i>
        </div>
      </div>
      <div class="modal-body">
        <!-- Tree Picker Pop-up -->
        <div id="treePickerDiv" class="modal-panel-body">
          <div style="padding:10px; display:inline-block;">
            <!-- Tree Nodes -->
            <ul id="baseUl">
              <li ng-repeat="i1 in data.treelist" id="{{i1.id}}" idnumber="{{i1.idnumber}}" sysid="{{i1.sysid}}"
                  nodetype="{{i1.nodetype}}">
                <div class="myLiDivModal" ng-click="divClick($event)">
                  <div class="myImgHolderModal" ng-class="{'myLeafModal': i1.nodetype=='leaf', 'myPlusModal': i1.nodetype=='tree' && data.flatlist[i1.idnumber].ulstate=='collapsed', 'myMinusModal': i1.nodetype=='tree' && data.flatlist[i1.idnumber].ulstate!='collapsed'}"></div>
                  <div class="myNodeModal" ng-class="{'myLinkModal': i1.nodetype=='leaf'}">{{i1.name}}</div>
                </div>
                <!-- nested repeat i2 -->
                <ul ng-if="i1.nodetype=='tree'" ng-show="data.flatlist[i1.idnumber].ulstate=='expanded'" class="ng-hide modalTp">
                  <li ng-repeat="i2 in i1.servicelist" id="{{i2.id}}" idnumber="{{i2.idnumber}}" sysid="{{i2.sysid}}"
                      nodetype="{{i2.nodetype}}">
                    <div class="myLiDivModal" ng-click="divClick($event)">
                      <div class="myImgHolderModal" ng-class="{'myLeafModal': i2.nodetype=='leaf', 'myPlusModal': i2.nodetype=='tree' && data.flatlist[i2.idnumber].ulstate=='collapsed', 'myMinusModal': i2.nodetype=='tree' && data.flatlist[i2.idnumber].ulstate!='collapsed'}"></div>
                      <div class="myNodeModal" ng-class="{'myLinkModal': i2.nodetype=='leaf'}">{{i2.name}}</div>
                    </div>
                    <!-- nested repeat i3 -->
                    <ul ng-if="i2.nodetype=='tree'" ng-show="data.flatlist[i2.idnumber].ulstate=='expanded'" class="ng-hide modalTp">
                      <li ng-repeat="i3 in i2.servicelist" id="{{i3.id}}" idnumber="{{i3.idnumber}}" sysid="{{i3.sysid}}"
                          nodetype="{{i3.nodetype}}">
                        <div class="myLiDivModal" ng-click="divClick($event)">
                          <div class="myImgHolderModal" ng-class="{'myLeafModal': i3.nodetype=='leaf', 'myPlusModal': i3.nodetype=='tree' && data.flatlist[i3.idnumber].ulstate=='collapsed', 'myMinusModal': i3.nodetype=='tree' && data.flatlist[i3.idnumber].ulstate!='collapsed'}"></div>
                          <div class="myNodeModal" ng-class="{'myLinkModal': i3.nodetype=='leaf'}">{{i3.name}}</div>
                        </div>
                        <!-- nested repeat i4 -->
                        <ul ng-if="i3.nodetype=='tree'" ng-show="data.flatlist[i3.idnumber].ulstate=='expanded'" class="ng-hide modalTp">
                          <li ng-repeat="i4 in i3.servicelist" id="{{i4.id}}" idnumber="{{i4.idnumber}}" sysid="{{i4.sysid}}" 
                              nodetype="{{i4.nodetype}}">
                            <div class="myLiDivModal" ng-click="divClick($event)">
                              <div class="myImgHolderModal" ng-class="{'myLeafModal': i4.nodetype=='leaf', 'myPlusModal': i4.nodetype=='tree' && data.flatlist[i4.idnumber].ulstate=='collapsed', 'myMinusModal': i4.nodetype=='tree' && data.flatlist[i4.idnumber].ulstate!='collapsed'}"></div>
                              <div class="myNodeModal" ng-class="{'myLinkModal': i4.nodetype=='leaf'}">{{i4.name}}</div>
                            </div>
                            <!-- nested repeat i5 -->
                            <ul ng-if="i4.nodetype=='tree'" ng-show="data.flatlist[i2.idnumber].ulstate=='expanded'" class="ng-hide modalTp">
                              <li ng-repeat="i5 in i4.servicelist" id="{{i5.id}}" idnumber="{{i5.idnumber}}" sysid="{{i5.sysid}}" 
                                  nodetype="{{i5.nodetype}}">
                                <div class="myLiDivModal" ng-click="divClick($event)">
                                  <div class="myImgHolderModal" ng-class="{'myLeafModal': i5.nodetype=='leaf', 'myPlusModal': i5.nodetype=='tree' && data.flatlist[i5.idnumber].ulstate=='collapsed', 'myMinusModal': i5.nodetype=='tree' && data.flatlist[i5.idnumber].ulstate!='collapsed'}"></div>
                                  <div class="myNodeModal" ng-class="{'myLinkModal': i5.nodetype=='leaf'}">{{i5.name}}</div>
                                </div>
                              </li>
                            </ul>
                            <!-- end nested repeat i5 -->
                          </li>
                        </ul>
                        <!-- end nested repeat i4 -->
                      </li>
                    </ul>
                    <!-- end nested repeat i3 -->
                  </li>
                </ul>
                <!-- end nested repeat i2 -->
              </li>
            </ul>
            <!-- ---------- -->
          </div>
        </div>
        <!-- end Tree Picker Pop-up -->
      </div>
    </div>
  </div>
</div>
<!-- End Modal Tree Picker -->  
]]></template>
    </sp_widget>
</record_update>
