<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $rootScope, $element, spUtil, $window, u_cutassp) {
	if (u_cutassp.utilIsValueValidAndTrue($scope.data.uSettings.isDebugOn)) {
		console.log((new Date()).getTime()+'.Client - '+$scope.data.infotag);		
	}
	//
	/* widget controller */
	var c = this;

	c.myLabel = function (_p) { return u_cutassp.fmtLabel(_p); };
	c.myLog = function() {
		if (u_cutassp.utilIsValueValidAndTrue($scope.data.uSettings.isDebugOn)) {
			console.log((new Date()).getTime()+'.HTML View - '+$scope.data.infotag);
		}
		return '';
	};
	//
	if (typeof c.data == typeof myUndefined) { c.data = {}; }
	if (typeof c.data.tickets == typeof myUndefined ) { c.data.tickets = []; }		
	//	
	$scope.isCurrentSearch = false;
	$scope.data.action = '';
	$scope.data.isSortOn = {
		number:false,
		description:false,
		service:false,
		state:false,
		created:false
	};
	$scope.data.searchq = {
		number:'',
		description:'',
		service:'',
		state:'',
		created:''		
	};
	$scope.selStateSearchData='';
	$scope.inpCreatedSearchData='';

	//*** pagination 
	function _get() {
		spUtil.update($scope);
	}
	$scope.get = function() {
		_get();
	};
	
	$scope.previousPage = function(e) {
		$scope.data.action='prev';
		if ($scope.data.pagination.currentPage > 1)
			$scope.data.pagination.currentPage = $scope.data.pagination.currentPage - 1;
		else 
			$scope.data.pagination.currentPage = 0;
		$scope.get();
		return true;
	};

	$scope.nextPage = function(e) {
		$scope.data.action='next';
		$scope.data.pagination.currentPage = $scope.data.pagination.currentPage+1;
		$scope.get();
		return true;
	};	

	$scope.clickSearch = function(e) {
		if ($scope.utilIsSearch()) {
			$scope.utilResetSort();
			$scope.data.action = "search";
			$scope.get();
		}
	};
	$scope.crCatchSearch = function(e) {
		if ( e.keyCode === 13 ) {
			if ($scope.utilIsSearch()) {
				$scope.utilResetSort();
				$scope.data.action = "search";
				$scope.get();
			}
		} else {
			return false;
		}	
	};	
	$scope.onSelectChange = function() {
		var mySelect = $('#selStateSearchId');
		var mySelectValue = $('#selStateSearchId').val();
		if (this.$parent.utilIsSearch()) {
			this.$parent.utilResetSort();
			this.$parent.get();
		}
	};	
	$scope.onDateChange = function() {
		var mySelect = $('#inpCreatedSearchId');
		var mySelectValue = $('#inpCreatedSearchId').val();
		if (this.$parent.utilIsSearch()) {
			this.$parent.utilResetSort();
			this.$parent.get();
		}
	};	
	$scope.clickReset = function(e) {
		$scope.utilResetSearch();
		$scope.utilResetSort();
		$scope.data.action = "reset";
		$scope.get();
	};	
	$scope.cycleCondition = function(e) {
		var myIcon = $(e.currentTarget).children('i').first();
		//
		switch (true) {
			case myIcon.hasClass('fa-greater-than-equal'):
				myIcon.toggleClass('fa-greater-than-equal');
				myIcon.toggleClass('fa-less-than-equal');
				break;
			case myIcon.hasClass('fa-less-than-equal'):
				myIcon.toggleClass('fa-less-than-equal');
				myIcon.toggleClass('fa-greater-than');
				break;
			case myIcon.hasClass('fa-greater-than'):
				myIcon.toggleClass('fa-greater-than');
				myIcon.toggleClass('fa-less-than');
				break;
			case myIcon.hasClass('fa-less-than'):
				myIcon.toggleClass('fa-less-than');
				myIcon.toggleClass('fa-equals');
				break;
			case myIcon.hasClass('fa-equals'):
				myIcon.toggleClass('fa-equals');
				myIcon.toggleClass('fa-greater-than-equal');
				break;
		}	
		//
	};
	//
	var myNewTitle= {
		first: "Click to sort...",
		ascend: "Click to sort descending...",
		descend: "Click to sort ascending..."
	};
	var myClassRemove= {
		ascend: "fa-caret-down",
		descend: "fa-caret-up"
	};
	var myClassAdd= {
		ascend: "fa-caret-up",
		descend: "fa-caret-down"
	};
	var myNewSortAction = {
		ascend: "sortasc",
		descend: "sortdesc"
	};
	$scope.colSort = function(e) {

		var myHdrDiv = $(e.currentTarget);
		//
		var myId=myHdrDiv.attr('id');
		var myTitle=myHdrDiv.attr('title');
		var mySortState='';
		if (myTitle.indexOf("sort...")>-1) {
			mySortState= "ascend";
		} else if (myTitle.indexOf("descending...")>-1) {
			mySortState = "descend";
		} else if (myTitle.indexOf("ascending...")>-1) {
			mySortState= "ascend";
		}
		//
		var myParent = myHdrDiv.closest('div.myDivTableRow');
		var myDivSiblings = myParent.find('div');
		myDivSiblings.attr('title',myNewTitle.first);
		$scope.data.isSortOn = {
			number:false,
			description:false,
			service:false,
			state:false,
			created:false
		};
		//
		myHdrDiv.attr('title',myNewTitle[mySortState]);
		var myIcon = myHdrDiv.children('i').first();
		myIcon.removeClass(myClassRemove[mySortState]);
		myIcon.addClass(myClassAdd[mySortState]);
		//
		var mySortAction = '';
		switch(true) {
			case (myId.indexOf('Number')>-1):
				$scope.data.isSortOn.number = true;
				mySortAction = myNewSortAction[mySortState];
				break;
			case (myId.indexOf('Description')>-1):
				$scope.data.isSortOn.description = true;
				mySortAction = myNewSortAction[mySortState];
				break;
			case (myId.indexOf('Service')>-1):
				$scope.data.isSortOn.service = true;
				mySortAction = myNewSortAction[mySortState];
				break;
			case (myId.indexOf('State')>-1):
				$scope.data.isSortOn.state = true;
				mySortAction = myNewSortAction[mySortState];
				break;
			case (myId.indexOf('Created')>-1):			
				$scope.data.isSortOn.created = true;
				mySortAction = myNewSortAction[mySortState];
				break;
		}
		//
		if (mySortAction.length>0){
			if ($scope.utilIsSearch()) {
				//  We are sorting a search query
				mySortAction += 'search';
			}
			$scope.data.action = mySortAction;
			$scope.get();
		}
	};
	//
	$scope.utilIsSearch = function()
	{
		return _utilIsSearch();
	};
	function _utilIsSearch() {
		var mySearchQ = '';
		var myCharCount = 0;
		//
		mySearchQ = $('#inpNumberSearchId').val().trim();
		myCharCount += mySearchQ.length;
		$scope.data.searchq.number=mySearchQ;
		//
		mySearchQ = $('#inpDescriptionSearchId').val().trim();
		myCharCount += mySearchQ.length;
		$scope.data.searchq.description=mySearchQ;
		//
		mySearchQ = $('#inpServiceSearchId').val().trim();
		myCharCount += mySearchQ.length;
		$scope.data.searchq.service=mySearchQ;
		//
		mySearchQ = $('#selStateSearchId').val().trim();
		myCharCount += mySearchQ.length;		
		$scope.data.searchq.state=mySearchQ;
		//
		mySearchQ = $('#inpCreatedSearchId').val().trim();
		myCharCount += mySearchQ.length;	
		if (mySearchQ.length>0) {
			var myIcon = $('#inpCreatedSearchId').closest('div.myDivTableHead').find('i').first();
			switch(true) {
				case myIcon.hasClass('fa-greater-than-equal'):
					mySearchQ += '.GTE';
					break;
				case myIcon.hasClass('fa-less-than-equal'):
					mySearchQ += '.LTE';
					break;
				case myIcon.hasClass('fa-greater-than'):
					mySearchQ += '.GT';
					break;
				case myIcon.hasClass('fa-less-than'):
					mySearchQ += '.LT';
					break;
				case myIcon.hasClass('fa-equals'):
					mySearchQ += '.E';
					break;					
			}
		}
		$scope.data.searchq.created=mySearchQ;	
		//
		if (myCharCount>0) {
			$scope.data.action='search';
			$scope.isCurrentSearch=true;
		} else {
			$scope.isCurrentSearch=false;			
		}
		return ($scope.isCurrentSearch);
	}
	//
	$scope.utilResetSearch = function() {
		_utilResetSearch();
	};
	function _utilResetSearch() {
		$('#inpNumberSearchId').val('');
		$('#inpDescriptionSearchId').val('');
		$('#inpServiceSearchId').val('');
		$('#selStateSearchId').val('');
		$('#inpCreatedSearchId').val('');
		$scope.isCurrentSearch=false;	
	}
	//
	$scope.utilResetSort = function() {
		_utilResetSort();
	};	
	function _utilResetSort() {
		$scope.data.isSortOn = {
			number:false,
			description:false,
			service:false,
			state:false,
			created:false
		};		
		$('#divHdrNumberId').attr('title',myNewTitle.first);
		$('#divHdrDescriptionId').attr('title',myNewTitle.first);
		$('#divHdrServiceId').attr('title',myNewTitle.first);
		$('#divHdrStateId').attr('title',myNewTitle.first);
		$('#divHdrCreatedId').attr('title',myNewTitle.first);
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.panel-heading&#13;
{&#13;
	background-image: url(utassp_ticket_img.png);&#13;
	background-repeat: no-repeat;&#13;
	background-size: contain;  	&#13;
	padding-left: 50px;&#13;
}&#13;
.panel-body {&#13;
  /* background-color:#fff6e5; */&#13;
  padding:0 5px 15px 5px;&#13;
}&#13;
.panel-primary &gt; .panel-footer {&#13;
	background-color: #428bca;&#13;
	border-color: #428bca;	&#13;
}&#13;
&#13;
.myLeftAlign {&#13;
  text-align:left;&#13;
}&#13;
&#13;
/* ******** */&#13;
/* Searches */&#13;
input.form-control {&#13;
	height:auto;&#13;
	padding:2px 5px;&#13;
	font-size:11px;	&#13;
    margin-bottom:2px;&#13;
}&#13;
input.form-control.myAlignCenter {&#13;
	text-align:center;&#13;
}&#13;
input.form-control.myAlignLeft {&#13;
	text-align:left;&#13;
}&#13;
&#13;
div.myDivDateInput {&#13;
  padding-bottom:4px;&#13;
}&#13;
&#13;
input.form-control.myDateInput {&#13;
  height:20px;&#13;
  font-size:8px;&#13;
}&#13;
&#13;
div.myConditionCaseBtn {&#13;
  display:inline-block;&#13;
  background-color:#ddd;&#13;
  font-size:10px;&#13;
  color:#717171;&#13;
  text-align:center;&#13;
  padding:2px 5px;&#13;
  margin-right:2px;&#13;
  border-radius:3px;&#13;
  &amp;:hover{&#13;
    cursor:pointer;&#13;
    background-color:#ccc;&#13;
  }&#13;
}&#13;
&#13;
div.mySearchBtn {&#13;
  float:left;&#13;
  display:inline-block;&#13;
  background-color:#ddd;&#13;
  font-size:10px;&#13;
  color:#717171;&#13;
  text-align:center;&#13;
  padding:2px 5px;&#13;
  margin-right:0;&#13;
  border-radius:3px;&#13;
  &amp;:hover{&#13;
    cursor:pointer;&#13;
    background-color:#ccc;&#13;
  }&#13;
}&#13;
&#13;
div.myGrid {&#13;
  display: grid;&#13;
  grid-template-columns: auto 45px; &#13;
}&#13;
&#13;
i.mySortIcon {&#13;
  font-size:12px;&#13;
}&#13;
&#13;
#divHdrNumberId,&#13;
#divHdrDescriptionId,&#13;
#divHdrServiceId,&#13;
#divHdrStateId,&#13;
#divHdrCreatedId {&#13;
  &amp;:hover {&#13;
    cursor:pointer;&#13;
  }&#13;
}&#13;
&#13;
/* ********** */&#13;
/* Pagination */&#13;
a.mybtn {&#13;
    padding: 5px 10px;&#13;
    font-size: 12px;&#13;
    line-height: 1.5;&#13;
    border-radius: 3px;&#13;
  	color: #428bca;&#13;
	background-color: #fff;&#13;
    border-color: #ccc;  &#13;
    &amp;:hover {&#13;
      color: #333;&#13;
      background-color: #e6e6e6;&#13;
      border-color: #adadad;      &#13;
    }&#13;
}&#13;
&#13;
/* ************ */&#13;
/* DivTable  */&#13;
.myDivTable{ &#13;
  display:table; &#13;
  width: 100%;&#13;
  table-layout: fixed;  &#13;
}&#13;
.myDivTableRow { display:table-row; }&#13;
.myDivTableHeading { display:table-header-group;}&#13;
.myDivTableCell, .myDivTableHead { display:table-cell;}&#13;
.myDivTableHeading { display:table-header-group;}&#13;
.myDivTableFoot { display:table-footer-group;}&#13;
.myDivTableBody { display:table-row-group;}&#13;
&#13;
div.myGreyGridTable {&#13;
  width:100%;&#13;
  text-align:left;&#13;
  border-collapse:collapse;&#13;
}&#13;
&#13;
/* myDivTableHeading */&#13;
.myDivTable.myGreyGridTable .myDivTableHeading {&#13;
  background:#FFFFFF;&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
  border-bottom:1px solid #000000;&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableHeading div.myDivTableRow.myTopRow{&#13;
  border-bottom:none;&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
  .myDivTableHead {&#13;
  	font-weight:bold;&#13;
  	color:#000000;&#13;
  	text-align:center;&#13;
  	padding:1px 4px;&#13;
    border-right:1px solid #bbbbbb;     &#13;
  }&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow   {&#13;
  .myDivTableHead.myLeft { text-align:left; }&#13;
}&#13;
&#13;
/* myDivTableBody */&#13;
.myDivTable.myGreyGridTable .myDivTableBody {&#13;
	a.myDivTableRow {&#13;
  	width:100%;&#13;
  	height:100%; &#13;
    border-bottom:1px solid white;&#13;
    font-size:11px;&#13;
	}&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableBody {&#13;
  a.myDivTableRow:hover { &#13;
	  text-decoration:underline;&#13;
    background-color:#dddddd; &#13;
  }&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableBody {&#13;
	.myDivTableRow:nth-child(odd) { background: #EEEEEE; }&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableBody&#13;
{&#13;
	.myDivTableRow:last-child { border-bottom-style:none;  }&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
  .myDivTableCell  {&#13;
      border-right:1px solid #bbbbbb; &#13;
      padding:1px 4px;&#13;
  }&#13;
}&#13;
.myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
  .myDivTableCell.myCtr { text-align:center; }&#13;
}&#13;
&#13;
/* Foot Style */&#13;
.myGreyGridTable .myTableFootStyle {&#13;
  font-weight:bold;&#13;
  color:#333333;&#13;
  border-top:1px solid #333333;&#13;
}&#13;
&#13;
/* Link text */&#13;
a.myDivTableRow {&#13;
  color:#3a3f51;&#13;
  &amp;:hover {&#13;
    color:#428bca;&#13;
    text-decoration: underline;&#13;
  }&#13;
}&#13;
&#13;
/* ********** */&#13;
// Medium devices (tablets, 768px and up)&#13;
@media (min-width: 768.01px) &#13;
{&#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefLgOnlyShow { display:table-cell; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefMedUpShow { display:table-cell; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableCell.myDefMedOnlyShow { display:none; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
    .myDivTableHead:nth-last-child(1) { border-right-style:none; }&#13;
  } &#13;
  &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow  {&#13;
    .myDivTableCell.myDefLgOnlyShow { display:table-cell; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow  {&#13;
    .myDivTableCell.myDefMeUpShow { display:table-cell; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow  {&#13;
    .myDivTableCell.myDefMedOnlyShow { display:none; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell:nth-last-child(2) { border-right-style:none; }&#13;
  }  &#13;
  &#13;
  .myCol1 { width:10% }&#13;
  .myCol2 { width:43% }&#13;
  .myCol3 { width:20% }&#13;
  .myCol4 { width:12% }&#13;
  .myCol5 { width:18% }  &#13;
}&#13;
&#13;
@media (max-width: 880px) { &#13;
  .myCol1 { width:10% }&#13;
  .myCol2 { width:41% }&#13;
  .myCol3 { width:20% }&#13;
  .myCol4 { width:12% }&#13;
  .myCol5 { width:20% } &#13;
}&#13;
&#13;
// Medium devices (tablets, 768px and less)&#13;
@media (max-width: 768px) { &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefLgOnlyShow { display:none; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefMedUpShow { display:table-cell; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
    .myDivTableHead.myDefMedOnlyShow { display:table-cell; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
    .myDivTableHead:nth-last-child(1) { border-right-style:none; }&#13;
  }    &#13;
  &#13;
 .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell.myDefLgOnlyShow { display:none; }&#13;
  }   &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow  {&#13;
    .myDivTableCell.myDefMedUpShow { display:table-cell; }&#13;
  }    &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell.myDefMedOnlyShow { display:table-cell; }&#13;
  }   &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell:nth-last-child(1) { border-right-style:none; }&#13;
  }   &#13;
  &#13;
  .myCol1 { width:15% }&#13;
  .myCol2 { width:28% }&#13;
  .myCol3 { width:18% }&#13;
  .myCol4 { width:12% }&#13;
  .myCol5 { width:27% }     &#13;
}&#13;
&#13;
// Small devices (landscape phones, 576px and less)&#13;
@media (max-width: 575.98px) { &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefLgOnlyShow { display:none; }&#13;
  }&#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow  {&#13;
    .myDivTableHead.myDefMedUpShow { display:none; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
    .myDivTableHead.myDefMedOnlyShow { display:none; }&#13;
  }  &#13;
  .myDivTable.myGreyGridTable .myDivTableHeading .myDivTableRow {&#13;
    .myDivTableHead:nth-last-child(4) { border-right-style:none; }&#13;
  }   &#13;
  &#13;
 .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell.myDefLgOnlyShow { display:none; }&#13;
  }   &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow  {&#13;
    .myDivTableCell.myDefMedUpShow { display:none; }&#13;
  }    &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell.myDefMedOnlyShow {display:none; }&#13;
  }   &#13;
  .myDivTable.myGreyGridTable .myDivTableBody .myDivTableRow {&#13;
    .myDivTableCell:nth-last-child(5) { border-right-style:none; }&#13;
  }  &#13;
&#13;
  .myCol1 { width:35% }&#13;
  .myCol2 { width:65% }&#13;
  .myCol3 { width:0% }&#13;
  .myCol4 { width:0% }&#13;
  .myCol5 { width:0% }    &#13;
  &#13;
  &#13;
}&#13;
&#13;
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color,title</field_list>
        <has_preview>false</has_preview>
        <id>utassp01_my_open_tickets_widget</id>
        <internal>false</internal>
        <link/>
        <name>UTASSP My Open Tickets Widget</name>
        <option_schema>[&#13;
   {&#13;
      "hint": "If false, buttons are stacked on the right; if true, they are side-by-side",&#13;
      "name": "portal",&#13;
      "label": "Buttons stacked side by side",&#13;
      "type": "boolean"&#13;
   },&#13;
   {&#13;
      "hint": "Maximum number of elements that are shown in the list of approvals",&#13;
      "name": "maxitems",&#13;
      "default_value": "25",&#13;
      "label": "Max number of elements shown in the list (only positive numbers &gt; 0, 25 otherwise)",&#13;
      "type": "integer"&#13;
   },&#13;
   {&#13;
      "hint": "Is Hidden on Init?",&#13;
      "name": "ishidden",&#13;
      "default_value": "true",&#13;
      "label": "Is Hidden on Init",&#13;
      "type": "boolean"&#13;
   },&#13;
   {&#13;
      "name": "pageid",&#13;
      "label": "pageid",&#13;
      "type": "choice",&#13;
      "choices": [&#13;
         {&#13;
            "label": "index",&#13;
            "value": "utassp01_index"&#13;
         },&#13;
         {&#13;
            "label": "tickets",&#13;
            "value": "utassp01_my_tickets"&#13;
         }&#13;
      ]&#13;
   }&#13;
]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function ($sp, input, data, options, gs) {
	var myU = new u_utassp();	
	data.uSettings=myU.utilGetInstanceSettings($sp);	
	// *** Start: Debug only code *** //
	data.infotag = '';
	if (myU.utilIsValueValidAndTrue(data.uSettings.isDebugOn)) {
		data.infotag = myU.utilLog($sp,options);
	}
	// *** End: Debug only code *** //
	//

	data.pageid=options.pageid || '';
	if (typeof data.tickets == typeof myUndefined) { data.tickets = []; } 
	//we get only a max number of elements to avoid to have a big list of it
	var myMaxItems = options.maxitems || 0;
	//set 25 if maxnumber is undefined, empty or negative value
    myMaxItems = myMaxItems>0 ? myMaxItems : 25; 
	var myFirstRow = 0;
	var myLastRow =  parseInt(myMaxItems);
	var myCurrentPage = 0;    
    
	if (typeof data.pagination == typeof myUndefined) 
	{
		data.pagination = {};
		data.pagination.currentPage = myCurrentPage;
		data.pagination.hasNext = false;
		data.pagination.hasPrevious = false;
		data.showPagination = false;
	}    

	var myQuerySelect = 'both';
	var mySearchQueryList = [];
	var mySortField = '';
	var myIsSortAsc = false;
	var myIsSortDesc = false;
	var myIsSearch = false;
	var myIsReset = false;
	var myIsPage = false;
	var myIsStart = (typeof input == typeof myUndefined);
	if (!myIsStart) {
		//
		if (myU.utilIsValueValid(input.action)) {
			//Q: A page button?
			if (input.action.indexOf('prev')>-1 || input.action.indexOf('next')>-1) 
			{ 
				//A: Yes. 
				myIsPage = true;
				myCurrentPage = parseInt(input.pagination.currentPage);
				myFirstRow = (myCurrentPage * parseInt(myMaxItems));
				myLastRow =  parseInt(myFirstRow) +  parseInt(myMaxItems);					
			} else {
				//Q: Reset search btton?
				if (input.action.indexOf('reset')>-1) {
					//A: Yes
					myIsReset = true;
				} else {
					//Q: Sort button?
					if (input.action.indexOf('sort')>-1) {
						//A: Yes
						myIsSortAsc = (input.action.indexOf('asc')>-1);
						myIsSortDesc = !myIsSortAsc;
						if (myU.utilIsValueValid(input.isSortOn)) {
							switch(true) {
								case input.isSortOn.number:
									mySortField = 'number';
									break;
								case input.isSortOn.description:
									mySortField = 'short_description';
									break;
								case input.isSortOn.service:
									mySortField = 'u_business_service';
									break;
								case input.isSortOn.state:
									mySortField = 'state';
									break;
								case input.isSortOn.created:
									mySortField = 'sys_created_on';
									break;
								default:
									myIsSortAsc = false;
									myIsSortDesc = false;
							}
						}
					} 
					//Q: A search underway?
					if (input.action.indexOf('search')>-1) {
						//A: Yes
						myIsSearch=true;
						if (input.searchq.number.length>0) {
							mySearchQueryList.push({
								field: 'number',
								condition: 'CONTAINS',
								value: input.searchq.number
							});
						}
						if (input.searchq.description.length>0) {
							mySearchQueryList.push({
								field: 'short_description',
								condition: 'CONTAINS',
								value: input.searchq.description
							});
						}
						if (input.searchq.service.length>0) {
							var cisSysIdList = [];
							var cisGr = new GlideRecord('cmdb_ci_service');
							var cisQ = 'operational_status!=2^ORoperational_status=NULL';
							cisGr.addEncodedQuery(cisQ);
							cisGr.addQuery('name','CONTAINS',input.searchq.service);
							cisGr.query();
							while (cisGr.next()) {
								cisSysIdList.push(cisGr.getValue('sys_id'));
							}
							if (cisSysIdList.length <1) {
								cisSysIdList.push('0');
							}
							
							mySearchQueryList.push({
								field: 'u_business_service',
								condition: 'IN',
								value: cisSysIdList.join()
							});
						}
						if (input.searchq.state.length>0) {
							if (input.searchq.state.indexOf('incident')>-1) {
								myQuerySelect='incident';
								var myIncidentState = input.searchq.state.split('.')[0];
								mySearchQueryList.push({
									field: 'state',
									condition: '=',
									value: myIncidentState
								});								
							} else if (input.searchq.state.indexOf('request')>-1) {
								myQuerySelect='sc_request';
								var myRequestState = input.searchq.state.split('.')[0];
								mySearchQueryList.push({
									field: 'state',
									condition: '=',
									value: myRequestState
								});																
							} else {
								mySearchQueryList.push({
									field: 'state',
									condition: '=',
									value: input.searchq.state
								});																								
							}													
						}	
						if (input.searchq.created.length>0) {
							var mySearchPair = input.searchq.created.split('.');
							switch(mySearchPair[1]) {
								case 'GTE':
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '>=',
										value: mySearchPair[0]+' 00:00:00'
									});									
									break;
								case 'LTE':
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '<=',
										value: mySearchPair[0]+' 23:59:59'
									});									
									break;
								case 'GT':
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '>',
										value: mySearchPair[0]+' 23:59:59'
									});									
									break;
								case 'LT':
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '<',
										value: mySearchPair[0]+' 00:00:00'
									});									
									break;
								case 'E':
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '>=',
										value: mySearchPair[0]+' 00:00:00'
									});									
									mySearchQueryList.push({
										field: 'sys_created_on',
										condition: '<=',
										value: mySearchPair[0]+' 23:59:59'
									});																		
									break;
							}
						}
						//for (var x=0,xL=mySearchQueryList.length;x<xL;x++) {
						//	var y=mySearchQueryList[x]; 
						//	gs.info('...'+y.field+', '+y.condition+', '+y.value);
						//}
					}
				}				
			}
		}		
	} 

    var myTicketsList = [];
	var thisUser = gs.getUserID(); 
    var isItil = gs.getUser().hasRole('itil');
	var myGr = new GlideRecord('task');     
	var incidentQ = 'sys_class_name=incident'; 
	incidentQ += '^active=true';
	incidentQ += '^ref_incident.caller_id='+thisUser; 
	var sc_requestQ = 'sys_class_name=sc_request'; 
	sc_requestQ += '^active=true';
	sc_requestQ += '^ref_sc_request.requested_for='+thisUser; 
	var thisQuery = '';
	switch (myQuerySelect) {
		case 'incident':
			thisQuery = incidentQ;
			break;
		case 'sc_request':
			thisQuery = sc_requestQ;
			break;
		default:
			thisQuery = incidentQ + '^NQ' + sc_requestQ;
	}
	myGr.addEncodedQuery(thisQuery);
	if (!myIsStart && !myIsReset && !myIsPage) {
		if (myIsSortAsc || myIsSortDesc) {
			if (myIsSortAsc) {
				myGr.orderBy(mySortField);	
			} else if (myIsSortDesc) {
				myGr.orderByDesc(mySortField);	
			}
		}
		if (myIsSearch) {
			for (var i=0,iL=mySearchQueryList.length;i<iL;i++) {
				var q=mySearchQueryList[i];
				myGr.addQuery(q.field,q.condition,q.value);
			}
		}
	} else {
		myGr.orderByDesc('sys_created_on');		
	}
	myGr.chooseWindow(myFirstRow, myLastRow);
	myGr.query();
	var rowCount = myGr.getRowCount();
	while (myGr.next()) {
		var l_task = {
            number: myGr.getDisplayValue(),
            short_description: myGr.short_description.toString(),
            business_service: myGr.getDisplayValue('u_business_service'),
            state: myGr.getDisplayValue('state'),
            view: ((isItil) ? 'portal' : 'ess'),
            created: myGr.getDisplayValue('sys_created_on'),
            createddo: myGr.getDisplayValue('sys_created_on').split(' ')[0],        
            updated: myGr.getDisplayValue('sys_updated_on'),
            updateddo: myGr.getDisplayValue('sys_updated_on').split(' ')[0]        
        };
		var l_ticket = {
            sys_id: myGr.getUniqueValue(),
            table: myGr.getRecordClassName(),
            task: l_task            
        };
		myTicketsList.push(l_ticket);
	}
	data.tickets = myTicketsList;

	// for pagination
	data.pagination.hasNext = (myTicketsList.length == (parseInt(myLastRow) - parseInt(myFirstRow)) && parseInt(myLastRow) < parseInt(rowCount));
	data.pagination.hasPrevious = parseInt(myFirstRow) > 0;
	data.pagination.showPagination = data.pagination.hasPrevious || data.pagination.hasNext;
	data.pagination.currentPage = myCurrentPage;
})($sp, input, data, options, gs);]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-10-24 20:52:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>426e70624fd12300f006121f9310c756</sys_id>
        <sys_mod_count>229</sys_mod_count>
        <sys_name>UTASSP My Open Tickets Widget</sys_name>
        <sys_package display_value="utassp" source="x_287765_utassp">2e58c8624f112300f006121f9310c726</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="utassp">2e58c8624f112300f006121f9310c726</sys_scope>
        <sys_update_name>sp_widget_426e70624fd12300f006121f9310c756</sys_update_name>
        <sys_updated_by>welchv</sys_updated_by>
        <sys_updated_on>2019-04-02 16:28:48</sys_updated_on>
        <template><![CDATA[<div>
	<div class="panel panel-{{::options.color}} b" dummy="{{::c.myLog()}}">
		<div class="panel-heading myLeftAlign">
			<h2 class="h4 panel-title ">{{::options.title}}</h2>
		</div>
		<div class="panel-body">
			<div class="myGrid">
				<div id="divGridCol1Id">
					<div ng-if="(data.tickets.length > 0)">
						<div class="myDivTable myGreyGridTable">
							<div class="myDivTableHeading">
								<div class="myDivTableRow myTopRow">
									<div id="divHdrNumberId" class="myDivTableHead myCol1" title="Click to sort..." ng-click="colSort($event)">Number
										<i id="iconNumberSortId" ng-show="data.isSortOn.number" class="ng-hide fa fa-caret-up mySortIcon"></i>
									</div>
									<div id="divHdrDescriptionId" class="myDivTableHead myLeft myCol2" title="Click to sort..." ng-click="colSort($event)">Description
										<i id="iconDescriptionSortId" ng-show="data.isSortOn.description" class="ng-hide fa fa-caret-up mySortIcon"></i>
									</div>
									<div id="divHdrServiceId" class="myDivTableHead myDefMedUpShow myCol3" title="Click to sort..." ng-click="colSort($event)">Service
										<i id="iconServiceSortId" ng-show="data.isSortOn.service" class="ng-hide fa fa-caret-up mySortIcon"></i>
									</div>
									<div id="divHdrStateId" class="myDivTableHead myDefMedUpShow myCol4" title="Click to sort..." ng-click="colSort($event)">State
										<i id="iconStateSortId" ng-show="data.isSortOn.state" class="ng-hide fa fa-caret-up mySortIcon"></i>
									</div>
									<div id="divHdrCreatedId" class="myDivTableHead myDefMedUpShow myCol5" title="Click to sort..." ng-click="colSort($event)">Created
										<i id="iconCreatedSortId" ng-show="data.isSortOn.created" class="ng-hide fa fa-caret-up mySortIcon"></i>
									</div>
								</div>
								<div class="myDivTableRow">
									<div class="myDivTableHead myCol1">
										<input id="inpNumberSearchId"
											class="form-control myAlignCenter" 
											type="text"
											placeholder="" 
											aria-label="Search number" 
											aria-describedby="basic-addon1"
											ng-keypress="crCatchSearch($event);">                                
									</div>
									<div class="myDivTableHead myLeft myCol2">
										<input id="inpDescriptionSearchId"
											class="form-control myAlignLeft" 
											type="text"
											placeholder="" 
											aria-label="Search description" 
											aria-describedby="basic-addon1"
											ng-keypress="crCatchSearch($event);">                              
									</div>
									<div class="myDivTableHead myDefMedUpShow myCol3">
										<input id="inpServiceSearchId"
											class="form-control myAlignLeft" 
											type="text"
											placeholder="" 
											aria-label="Search service" 
											aria-describedby="basic-addon1"
											ng-keypress="crCatchSearch($event);">                                                            
									</div>
									<div class="myDivTableHead myDefMedUpShow myCol4">
										<select id="selStateSearchId"
												name="selStateSearchName" 
												ng-model="selStateSearchData"
												class="form-control" 
												style="font-size:9px;height:20px;padding:1px;position:relative;top:-2px;"
												ng-change="onSelectChange()">
										<option value="">Select...</option>
										<option value="1">New</option>
										<option value="15">Unassigned</option>
										<option value="16">Assigned</option>
										<option value="20">Scheduled work</option>
										<option value="18">Waiting for Approval</option>
										<option value="21">Waiting for Other Tasks</option>
										<option value="17">Waiting for User</option>
										<option value="19">Waiting for Vendor</option>
										<option value="3.sc_request">Complete (Request)</option>
										<option value="6.incident">Resolved (Incident)</option>
										<option value="7">Closed</option>
										<option value="12.sc_request">Cancelled (Request)</option>
										</select>                                  
									</div>
									<div class="myDivTableHead myDefMedUpShow myCol5">
										<div style="display:inline-block;">
											<div class="myConditionCaseBtn" title="Select condition case..." style="position:relative;top:-1px;text-align:right;" ng-click="cycleCondition($event);">
												<i id="dateSearchConditionCase" class="fa fa-greater-than-equal"></i>
											</div>
											<div style="position:relative;top:-2px;display:inline-block;text-align:left;">
												<input id="inpCreatedSearchId"
													class="form-control myAlignCenter myDateInput" 
													type="date"
													placeholder="" 
													aria-label="Search date" 
													aria-describedby="basic-addon1"
													style="display:inline-block;width:100px;"
													ng-model="inpCreatedSearchData"
													ng-change="onDateChange()">                                                              
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="myDivTableBody">
								<a  ng-repeat="ticket in data.tickets" ng-href="?id=utassp02_form&table={{ticket.table}}&sys_id={{ticket.sys_id}}&view={{ticket.view}}&pageid={{data.pageid}}" class="myDivTableRow">
									<div class="myDivTableCell myCtr myCol1">{{ticket.task.number}}</div>
									<div class="myDivTableCell myCol2">{{ticket.task.short_description}}</div>
									<div class="myDivTableCell myDefMedUpShow myCol3">{{ticket.task.business_service}}</div>
									<div class="myDivTableCell myCtr myDefMedUpShow myCol4">{{ticket.task.state}}</div>
									<div class="myDivTableCell myCtr myDefLgOnlyShow myCol5">{{ticket.task.created}}</div>
									<div class="myDivTableCell myCtr myDefMedOnlyShow myCol5">{{ticket.task.createddo}}</div>
								</a>
							</div>
						</div>						  
					</div>
					<div ng-if="!(data.tickets.length > 0)">
						${No tickets}
					</div>
				</div>
				<div id="divGridCol2Id" class="mySearchIcons">	
					<div style="position:relative;top:22px;">
						<div class="mySearchBtn" style="margin-right:2px" title="Click to search..." ng-click="clickSearch($event)"><i class="fa fa-search"></i></div>
						<div ng-show="isCurrentSearch" class="ng-hide mySearchBtn" title="Click to reset search..." ng-click="clickReset($event)"><i class="fa fa-refresh"></i></div>                        
					</div>
				</div> 					 
			</div>
			<div class="panel-{{::options.color}} panel-footer clearfix">
				<a id="previous-btn" href="javascript:void(0)" ng-click="previousPage($event)" ng-show="data.pagination.hasPrevious" class="pull-left btn btn-sm btn-default mybtn" aria-label="${Pagination button Previous}">
					<i class="fa fa-arrow-left m-r-sm" aria-hidden="true"></i>${&nbsp;Previous}</a>
				<a id="next_btn" href="javascript:void(0)" ng-click="nextPage($event)" ng-show="data.pagination.hasNext" class="pull-right btn btn-sm btn-default mybtn" aria-label="${Pagination button Next}">
						${Next&nbsp;}<i class="fa fa-arrow-right m-r-sm col-md-offset-3" aria-hidden="true"></i></a>
			</div>
		</div>
	</div>
</div>
 ]]></template>
    </sp_widget>
</record_update>
